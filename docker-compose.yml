version: '3.8'

services:
  ayo_small_container:
    container_name: ayo_small_container

    # üì¶ Construction de l‚Äôimage Docker √† partir du Dockerfile dans le dossier actuel
    build:
      context: .

    # üåê Exposition du port local utilis√© par le serveur Flask de main.py
    ports:
      - "5678:5678"

    # üìÅ Volumes mont√©s entre Windows (r√©el) et Docker (virtuel)
    # Ces dossiers doivent d√©j√† exister sur ton disque D:
    volumes:
      - D:/models_core/mistral7b_ayo_small:/app                # Code source principal (main.py, Dockerfile, etc.)
      - D:/models_core:/models_core                            # Mod√®les Mistral, checkpoints, archives
      - D:/config_core:/configs_core                           # Fichiers JSON de configuration globale
      - D:/logs_core:/logs_core                                # Logs des sessions AyO (journalisation locale)
      - D:/06_results:/results_core                            # R√©sultats g√©n√©r√©s ou export√©s
      - D:/memory_core:/memory_core                            # UID, r√¥les, statuts, historique de session
      - D:/01_data_raw:/raw_data                               # Donn√©es brutes d‚Äôentr√©e (ex : audio/image non trait√©e)
      - D:/02_data_proc:/proc_data                             # Donn√©es trait√©es, enrichies ou anonymis√©es
      - D:/docker_core/n8n_data:/n8n_data                      # N8N local (workflows, √©v√©nements, logs)

    # üîß Variables d‚Äôenvironnement accessibles dans main.py
    environment:
      - PORT=5678                        # Port utilis√© par Flask
      - APP_MODE=local                  # Mode d'ex√©cution de l'agent
      - AYO_MODEL_PATH=/app             # Chemin du code op√©rationnel dans le conteneur
      - N8N_PATH=/n8n_data              # Donn√©es N8N (workflows, logs, DB locale)
      - STATIC_PATH=/www                # R√©pertoire statique (r√©serv√©)
      - CONFIG_PATH=/configs_core       # Configurations de g√©n√©ration, tokens, etc.
      - LOG_PATH=/logs_core             # Acc√®s aux logs globaux
      - RESULT_PATH=/results_core       # Fichiers de sortie et exports
      - RAW_PATH=/raw_data              # Donn√©es entrantes brutes
      - PROC_PATH=/proc_data            # Donn√©es trait√©es / nettoy√©es
      - MODEL_ARCHIVE=/models_core      # Mod√®les Mistral, Ollama, etc.
      - MEMORY_PATH=/memory_core        # UID, r√¥le, m√©moire active

